<!DOCTYPE html>
<html lang="en-US">

<head>
    <script src="//code.tidio.co/m6kdihlblyie9jlb1otfxudgzisuz4fx.js" async></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programme Detail</title>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">
    <link rel="shortcut icon" href="https://web.tarc.edu.my/portal/images/tarucLogo.png" type="image/x-icon">
    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">

    <!-- GET VISITOR IP ON TERMINAL -->
    <script type="text/javascript" src="js/devicedetect.js"></script>

    <!-- CUSTOM STYLE -->
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/userlog.js"></script>
    <style>
        /* Add your CSS styles here */
        .center2 {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>

<body class="size-1520 primary-color-red background-dark">

    <!-- ======= Cta Section ======= -->
    <section id="cta" class="cta mt-5 pd-2">
        <div class="container pt-5">

            <div class="row">
                <div class="col text-center text-lg-start d-flex justify-content-center">
                    <h3> Reply Enquiry</h3>

                </div>
            </div>

        </div>
    </section><!-- End Cta Section -->

    <!--Section: Contact v.2-->
    <section class="m-5 bg-light shadow" style="padding: 5%;border-radius: 20px;">

        <div class="container mb-4">
            <ul class="nav nav-pills nav-justified">
                <li class="nav-item">
                    <a class="nav-link active" id="tab1" aria-current="page" onclick="showTab(1)">Pending</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="tab2" onclick="showTab(2)">Completed</a>
                </li>
            </ul>
        </div>


        <div>
            <div class="accordion" id="accordionExample">
                <form id="submitReply" data-parsley-validate>
                    <div id="tab1-content">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#col1"
                                    aria-expanded="true" aria-controls="collapseOne">
                                    <h5 class="mb-0 text-dark" id="title">
                                        Title
                                    </h5>
                                </button>
                            </div>

                            <div id="col1" class="collapse show" aria-labelledby="headingOne"
                                data-parent="#accordionExample">
                                <div class="card-body">

                                    <!-- <input type="hidden" id="title" value="title">
                                    <input type="hidden" id="message" value="title">
                                    <input type="hidden" id="status" value="title">
                                    <input type="hidden" id="cdate" value="title">
                                    <input type="hidden" id="appId" value="title">-->
                                    <input type="hidden" id="qryId" value="">

                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th scope="row">Applicant Id</th>
                                                <td style="width: 70%;" id="appId">Mark</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Message</th>
                                                <td id="message">message</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Submitted on</th>
                                                <td id="cdate">date</td>
                                            </tr>
                                            <tr>

                                            </tr>
                                        </tbody>

                                    </table>

                                    <div class="form-group">
                                        <label for="exampleFormControlTextarea1">Reply</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1"
                                            rows="3"></textarea>
                                    </div>
                                    <button class="btn btn-primary right" style="margin: 3%;"
                                        @click="submitForm('enquiry', 1)">Submit</button>

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="tab2-content" style="margin-top: 30px;">
            <div class="card text-dark bg-light mb-3">
                <div class="card-header">Header</div>
                <div class="card-body">
                    <h5 class="card-title">Light card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                        the card's content.</p>
                </div>
            </div>

        </div>

    </section>


    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script>
    <script src="../plugins/axios/axios.min.js"></script>
    <script src="../js/request.js"></script>
    <script src="../plugins/vue/vue.js"></script>
    <script src="../api/query.js"></script>

    <script>
        new Vue({
            el: '#submitReply',
            data() {
                return {
                    enquiry: {
                        "queryId": "",
                        "title": "",
                        "question": "",
                        "reply": "",
                        "queryStatus": "",
                        "created": "",
                        "completed": "",
                        "applicantId": ""
                    },
                }
            },
            mounted() {
                // Data not available in localStorage, fetch it from the API
                console.log('MOUNT QUERY :');
                this.init();
            },
            created() {
                // Call the init method when the component is created
                this.init();
            },
            methods: {
                init() {
                    console.log('INIT QUERY :');
                    getAllQueries()
                        .then((response) => {
                            console.log('Response:', response);
                            // Rest of your code
                            let enquiryList = response.data;

                            console.log(enquiryList);

                            //let html = document.getElementById('tab2-content').innerHTML;
                            var userInfo = JSON.parse(localStorage.getItem('userInfo'));
                            let applicantId = userInfo['applicantId'];

                            let pending = false;

                            let html = "";
                            let html2 = "";
                            for (let i = 0; i < enquiryList.length && pending == false; i++) {
                                let enquiry = enquiryList[i];
                                console.log(i);

                                let status = enquiry['queryStatus'];
                                let qryId = enquiry['queryId'];
                                let appId = enquiry['applicantId'];
                                let title = enquiry['title'];
                                let ques = enquiry['question'];
                                let reply = enquiry['reply'];
                                let cdate = enquiry['completed'];
                                let rdate = enquiry['created'];

                                if (status == 'pending') {

                                    document.getElementById('qryId').value = qryId;
                                    document.getElementById('appId').textContent = appId;
                                    document.getElementById('title').textContent = title;
                                    document.getElementById('message').textContent = ques;
                                    document.getElementById('cdate').textContent = cdate;

                                    pending = true;
                                } else if (status == 'completed') {
                                    html2 += `
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#col${qryId}"
                                    aria-expanded="false" aria-controls="collapseOne">
                                    <h5 class="mb-0 text-dark" id="title">
                                        ${title}
                                    </h5>
                                </button>
                            </div>

                            <div id="col${qryId}" class="collapse" aria-labelledby="headingOne"
                                data-parent="#accordionExample">
                                <div class="card-body">

                                    <!-- <input type="hidden" id="title" value="title">
                                    <input type="hidden" id="message" value="title">
                                    <input type="hidden" id="status" value="title">
                                    <input type="hidden" id="cdate" value="title">
                                    <input type="hidden" id="appId" value="title">-->
                                    <input type="hidden" id="qryId" value="">

                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th scope="row">Applicant Id</th>
                                                <td style="width: 70%;" id="appId">${appId}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Submitted on</th>
                                                <td id="cdate">${cdate}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Message</th>
                                                <td id="message">${ques}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Replied on</th>
                                                <td id="cdate">${rdate}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Reply</th>
                                                <td id="cdate">${reply}</td>
                                            </tr>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>  
                                    `;
                                }
                            }

                            if (pending == false) {
                                document.getElementById('tab1-content').innerHTML = `<h3 class="text-dark">No Pending Queries</h3>`;
                            }
                            document.getElementById('tab2-content').innerHTML = html2;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });
                },
                submitForm(enquiry, id) {
                    event.preventDefault();

                    console.log('ADD QUERY :', enquiry);

                    const params = { ...this.enquiry };
                    //params.applicantId = document.getElementById('appId').value;
                    // params.title = document.getElementById('title').value;
                    // params.question = document.getElementById('message').value;
                    // params.reply = document.getElementById('reply').value;
                    // params.queryStatus = document.getElementById('status').value;
                    // params.created = document.getElementById('cdate').value;
                    // params.completed = new Date();
                    //params.queryId = document.getElementById('qryId').value;

                    console.log(id);
                    params.queryId = document.getElementById('qryId').value;
                    params.applicantId = document.getElementById('appId').textContent;
                    params.title = document.getElementById('title').textContent;
                    params.question = document.getElementById('message').value;
                    params.reply = document.getElementById('exampleFormControlTextarea1').value;
                    params.queryStatus = "completed";
                    params.created = new Date(document.getElementById('cdate').textContent);
                    params.completed = new Date();

                    console.log('PARAMS :', params);

                    editQuery(params).then((response) => {
                        console.log('Response:', response);
                        alert('Replied Successfully');
                        // Rest of your code
                        window.onload();
                    })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });

                }

            },
        });
    </script>
    <script>

        onload = function () {
            // if (localStorage.getItem('userInfo') == null) {
            //     //navigate user to other page
            //     localStorage.setItem('redirect', 'submitEnquiry.html');
            //     window.location.href = "../page/login.html";
            //     //
            // } else {
            //     //get user info
            //     var userInfo = JSON.parse(localStorage.getItem('userInfo'));
            //     console.log(userInfo);
            //     let userEmail = userInfo['applicantEmail'];
            //     document.getElementById('email').value = userEmail;
            //     document.getElementById('name').value = userEmail.split('@')[0];

            // }

            document.getElementById('tab2-content').style.display = 'none';

        }

        function showTab(tabIndex) {
            const tabContents = document.querySelectorAll('.nav-link');

            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Show the selected tab content
            const selectedTabContent = document.getElementById(`tab${tabIndex}`);
            selectedTabContent.classList.add('active');

            if (tabIndex == 1) {
                document.getElementById('tab1-content').style.display = 'block';
                document.getElementById('tab2-content').style.display = 'none';
            } else if (tabIndex == 2) {
                document.getElementById('tab2-content').style.display = 'block';
                document.getElementById('tab1-content').style.display = 'none';
            }

        }
    </script>
    <script type="text/javascript" src="assets/js/header.js"></script>
    <script type="text/javascript" src="assets/js/footer.js"></script>
    <script src="assets/js/main.js"></script>
</body>

</html>