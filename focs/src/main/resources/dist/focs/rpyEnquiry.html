<!DOCTYPE html>
<html lang="en-US">

<head>
    <script src="//code.tidio.co/m6kdihlblyie9jlb1otfxudgzisuz4fx.js" async></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programme Detail</title>
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/icons.css">
    <link rel="stylesheet" href="css/responsee.css">
    <link rel="stylesheet" href="owl-carousel/owl.carousel.css">
    <link rel="stylesheet" href="owl-carousel/owl.theme.css">
    <!-- CUSTOM STYLE -->
    <link rel="stylesheet" href="css/template-style.css">
    <link href="https://fonts.googleapis.com/css?family=Barlow:100,300,400,700,800&amp;subset=latin-ext"
        rel="stylesheet">
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/userlog.js"></script>
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="../plugins/axios/axios.min.js"></script>
    <script src="../plugins/vue/vue.js"></script>
    <script src="../api/programme.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.css" rel="stylesheet" />
    <!-- MDB -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.1/mdb.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <style>
        /* Add your CSS styles here */
        .center2 {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .nav-link {
            color: white;
        }
    </style>
</head>

<body class="size-1520 primary-color-red background-dark">
    <!-- HEADER -->
    <header class="grid headerjs">
    </header>

    <!--Section: Contact v.2-->
    <section class="mb-4 bg-light " style="margin: 10%;padding: 5%;border-radius: 20px;">

        <ul class="nav nav-pills nav-justified">
            <li class="nav-item">
                <a class="nav-link active" id="tab1" aria-current="page" onclick="showTab(1)">Pending</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tab2" onclick="showTab(2)">Completed</a>
            </li>
        </ul>


        <div>
            <div class="accordion" id="accordionExample">
                <form id="submitReply" data-parsley-validate>
                    <div id="tab1-content">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#col1"
                                    aria-expanded="true" aria-controls="collapseOne">
                                    <h5 class="mb-0 text-dark" id="title">
                                        Title
                                    </h5>
                                </button>
                            </div>

                            <div id="col1" class="collapse show" aria-labelledby="headingOne"
                                data-parent="#accordionExample">
                                <div class="card-body">

                                    <!-- <input type="hidden" id="title" value="title">
                                    <input type="hidden" id="message" value="title">
                                    <input type="hidden" id="status" value="title">
                                    <input type="hidden" id="cdate" value="title">
                                    <input type="hidden" id="appId" value="title">-->
                                    <input type="hidden" id="qryId" value="">

                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th scope="row">Applicant Id</th>
                                                <td style="width: 70%;" id="appId">Mark</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Message</th>
                                                <td id="message">message</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Submitted on</th>
                                                <td id="cdate">date</td>
                                            </tr>
                                            <tr>

                                            </tr>
                                        </tbody>

                                    </table>

                                    <div class="form-group">
                                        <label for="exampleFormControlTextarea1">Reply</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1"
                                            rows="3"></textarea>
                                    </div>
                                    <button class="btn btn-primary right" style="margin: 3%;"
                                        @click="submitForm('enquiry', 1)">Submit</button>

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="tab2-content" style="margin-top: 30px;">
            <div class="card text-dark bg-light mb-3">
                <div class="card-header">Header</div>
                <div class="card-body">
                    <h5 class="card-title">Light card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                        the card's content.</p>
                </div>
            </div>

        </div>

    </section>


    <!-- FOOTER -->
    <footer class="grid">
        <!-- Footer - top -->
        <!-- Image-->
        <div class="s-12 l-3 m-row-3 margin-bottom background-image" style="background-image:url(img/img-04.jpg)"></div>

        <div class="s-12 m-9 l-3 padding-2x margin-bottom background-dark">
            <h2 class="text-strong text-uppercase">Who We Are?</h2>
            <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt ut
                laoreet dolore magna aliquam erat volutpat. Lorem ipsum dolor sit amet, consectetuer adipiscing elit,
                sed diam nonummy.</p>
        </div>

        <div class="s-12 m-9 l-3 padding-2x margin-bottom background-dark">
            <h2 class="text-strong text-uppercase">Where We Are?</h2>
            <img class="full-img" src="img/map.svg" alt="" />
        </div>

        <div class="s-12 m-9 l-3 padding-2x margin-bottom background-dark">
            <h2 class="text-strong text-uppercase">Contact Us</h2>
            <p><b class="text-primary margin-right-10">P</b> 0800 4521 800 50</p>
            <p><b class="text-primary margin-right-10">M</b> <a class="text-primary-hover"
                    href="mailto:contact@sampledomain.com">contact@sampledomain.com</a></p>
            <p><b class="text-primary margin-right-10">M</b> <a class="text-primary-hover"
                    href="mailto:office@sampledomain.com">office@sampledomain.com</a></p>
        </div>

        <!-- Footer - bottom -->
        <div class="s-12 text-center margin-bottom">
            <p class="text-size-12">Copyright 2019, Vision Design - graphic zoo</p>
            <p class="text-size-12">All images have been purchased from Bigstock. Do not use the images in your website.
            </p>
            <p><a class="text-size-12 text-primary-hover" href="http://www.myresponsee.com"
                    title="Responsee - lightweight responsive framework">Design and coding by Responsee Team</a></p>
        </div>
    </footer>
    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script>
    <script src="../plugins/axios/axios.min.js"></script>
    <script src="../js/request.js"></script>
    <script src="../plugins/vue/vue.js"></script>
    <script src="../api/query.js"></script>

    <script>
        new Vue({
            el: '#submitReply',
            data() {
                return {
                    enquiry: {
                        "queryId": "",
                        "title": "",
                        "question": "",
                        "reply": "",
                        "queryStatus": "",
                        "created": "",
                        "completed": "",
                        "applicantId": ""
                    },
                }
            },
            mounted() {
                // Data not available in localStorage, fetch it from the API
                console.log('MOUNT QUERY :');
                this.init();
            },
            created() {
                // Call the init method when the component is created
                this.init();
            },
            methods: {
                init() {
                    console.log('INIT QUERY :');
                    getAllQueries()
                        .then((response) => {
                            console.log('Response:', response);
                            // Rest of your code
                            let enquiryList = response.data;

                            console.log(enquiryList);

                            //let html = document.getElementById('tab2-content').innerHTML;
                            var userInfo = JSON.parse(localStorage.getItem('userInfo'));
                            let applicantId = userInfo['applicantId'];

                            let pending = false;

                            let html = "";
                            let html2 = "";
                            for (let i = 0; i < enquiryList.length && pending == false; i++) {
                                let enquiry = enquiryList[i];
                                console.log(i);

                                let status = enquiry['queryStatus'];
                                let qryId = enquiry['queryId'];
                                let appId = enquiry['applicantId'];
                                let title = enquiry['title'];
                                let ques = enquiry['question'];
                                let reply = enquiry['reply'];
                                let cdate = enquiry['completed'];
                                let rdate = enquiry['created'];

                                if (status == 'pending') {

                                    document.getElementById('qryId').value = qryId;
                                    document.getElementById('appId').textContent = appId;
                                    document.getElementById('title').textContent = title;
                                    document.getElementById('message').textContent = ques;
                                    document.getElementById('cdate').textContent = cdate;

                                    pending = true;
                                } else if (status == 'completed') {
                                    html2 += `
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#col${qryId}"
                                    aria-expanded="false" aria-controls="collapseOne">
                                    <h5 class="mb-0 text-dark" id="title">
                                        ${title}
                                    </h5>
                                </button>
                            </div>

                            <div id="col${qryId}" class="collapse" aria-labelledby="headingOne"
                                data-parent="#accordionExample">
                                <div class="card-body">

                                    <!-- <input type="hidden" id="title" value="title">
                                    <input type="hidden" id="message" value="title">
                                    <input type="hidden" id="status" value="title">
                                    <input type="hidden" id="cdate" value="title">
                                    <input type="hidden" id="appId" value="title">-->
                                    <input type="hidden" id="qryId" value="">

                                    <table class="table table-borderless">
                                        <tbody>
                                            <tr>
                                                <th scope="row">Applicant Id</th>
                                                <td style="width: 70%;" id="appId">${appId}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Submitted on</th>
                                                <td id="cdate">${cdate}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Message</th>
                                                <td id="message">${ques}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Replied on</th>
                                                <td id="cdate">${rdate}</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Reply</th>
                                                <td id="cdate">${reply}</td>
                                            </tr>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                        </div>  
                                    `;
                                }
                            }

                            if (pending == false) {
                                document.getElementById('tab1-content').innerHTML = `<h3 class="text-dark">No Pending Queries</h3>`;
                            }
                            document.getElementById('tab2-content').innerHTML = html2;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });
                },
                submitForm(enquiry, id) {
                    event.preventDefault();

                    console.log('ADD QUERY :', enquiry);

                    const params = { ...this.enquiry };
                    //params.applicantId = document.getElementById('appId').value;
                    // params.title = document.getElementById('title').value;
                    // params.question = document.getElementById('message').value;
                    // params.reply = document.getElementById('reply').value;
                    // params.queryStatus = document.getElementById('status').value;
                    // params.created = document.getElementById('cdate').value;
                    // params.completed = new Date();
                    //params.queryId = document.getElementById('qryId').value;

                    console.log(id);
                    params.queryId = document.getElementById('qryId').value;
                    params.applicantId = document.getElementById('appId').textContent;
                    params.title = document.getElementById('title').textContent;
                    params.question = document.getElementById('message').value;
                    params.reply = document.getElementById('exampleFormControlTextarea1').value;
                    params.queryStatus = "completed";
                    params.created = new Date(document.getElementById('cdate').textContent);
                    params.completed = new Date();

                    console.log('PARAMS :', params);

                    editQuery(params).then((response) => {
                        console.log('Response:', response);
                        alert('Replied Successfully');
                        // Rest of your code
                        window.onload();
                    })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });

                }

            },
        });
    </script>
    <script>

        onload = function () {
            // if (localStorage.getItem('userInfo') == null) {
            //     //navigate user to other page
            //     localStorage.setItem('redirect', 'submitEnquiry.html');
            //     window.location.href = "../page/login.html";
            //     //
            // } else {
            //     //get user info
            //     var userInfo = JSON.parse(localStorage.getItem('userInfo'));
            //     console.log(userInfo);
            //     let userEmail = userInfo['applicantEmail'];
            //     document.getElementById('email').value = userEmail;
            //     document.getElementById('name').value = userEmail.split('@')[0];

            // }

            document.getElementById('tab2-content').style.display = 'none';

        }

        function showTab(tabIndex) {
            const tabContents = document.querySelectorAll('.nav-link');

            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Show the selected tab content
            const selectedTabContent = document.getElementById(`tab${tabIndex}`);
            selectedTabContent.classList.add('active');

            if (tabIndex == 1) {
                document.getElementById('tab1-content').style.display = 'block';
                document.getElementById('tab2-content').style.display = 'none';
            } else if (tabIndex == 2) {
                document.getElementById('tab2-content').style.display = 'block';
                document.getElementById('tab1-content').style.display = 'none';
            }

        }
    </script>
    <script type="text/javascript" src="js/headerAppend.js"></script>
</body>

</html>