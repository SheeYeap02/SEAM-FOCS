<!DOCTYPE html>
<html lang="en-US">

<head>
    <script src="//code.tidio.co/m6kdihlblyie9jlb1otfxudgzisuz4fx.js" async></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="icon" type="image/png" href="img/newLogo.png"> -->
    <link rel="shortcut icon" href="https://web.tarc.edu.my/portal/images/tarucLogo.png" type="image/x-icon">
    <title>Contact Us</title>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">

    <!-- GET VISITOR IP ON TERMINAL -->
    <script type="text/javascript" src="js/devicedetect.js"></script>

    <style>
        /* Add your CSS styles here */
        .center2 {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .row {
            padding-top: 3%;
        }
    </style>
</head>

<body class="size-1520 primary-color-red background-dark">
    <!-- HEADER -->
    <header class="grid headerjs">
    </header>

    <!-- MAIN -->
    <main role="main">
        <!-- ======= Cta Section ======= -->
        <section id="cta" class="cta mt-5 pd-2">
            <div class="container pt-5">

                <div class="row">
                    <div class="col text-center text-lg-start d-flex justify-content-center">
                        <h3>Submit Enquiry</h3>

                    </div>
                    <p class="text-center center">Do you have any questions? Please
                        do not hesitate to contact us directly. Our team will come back to you within a matter of hours
                        to
                        help you.</p>
                </div>

            </div>
        </section><!-- End Cta Section -->

        <!--Section: Contact v.2-->
        <section class="m-5 bg-light shadow" style="padding: 5%;border-radius: 20px;">

            <ul class="nav nav-pills nav-justified">
                <li class="nav-item">
                    <a class="nav-link active" id="tab1" aria-current="page" onclick="showTab(1)">Submission</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="tab2" onclick="showTab(2)">Progression</a>
                </li>
            </ul>


            <div id="tab1-content">
                <form id="submitEnquiry" data-parsley-validate>
                    <!--Section heading-->
                    <h2 class="h1-responsive font-weight-bold text-dark text-center my-4">Contact us</h2>
                    <!--Section description-->
                    <p class="text-center text-dark w-responsive mx-auto mb-5">Do you have any questions? Please do not
                        hesitate
                        to
                        contact us directly. Our team will come back to you within
                        a matter of hours to help you.</p>

                    <div class="row">

                        <!--Grid column-->
                        <div class="col-md-9 mb-md-0 mb-5">
                            <form id="contact-form" name="contact-form" action="mail.php" method="POST">

                                <!--Grid row-->
                                <div class="row">

                                    <!--Grid column-->
                                    <div class="col-md-6">
                                        <div class="md-form mb-0">
                                            <input type="text" id="name" name="name" class="form-control" disabled>
                                            <label for="name" class="">Username</label>
                                        </div>
                                    </div>
                                    <!--Grid column-->

                                    <!--Grid column-->
                                    <div class="col-md-6">
                                        <div class="md-form mb-0">
                                            <input type="text" id="email" name="email" class="form-control" disabled>
                                            <label for="email" class="">Your email</label>
                                        </div>
                                    </div>
                                    <!--Grid column-->

                                </div>
                                <!--Grid row-->

                                <!--Grid row-->
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="md-form mb-0">
                                            <input type="text" id="title" name="title" class="form-control">
                                            <label for="title" class="">Title</label>
                                        </div>
                                    </div>
                                </div>
                                <!--Grid row-->

                                <!--Grid row-->
                                <div class="row">

                                    <!--Grid column-->
                                    <div class="col-md-12">

                                        <div class="md-form">
                                            <textarea type="text" id="message" name="message" rows="2"
                                                class="form-control md-textarea"></textarea>
                                            <label for="message">Your message</label>
                                        </div>

                                    </div>
                                </div>
                                <!--Grid row-->

                            </form>

                            <div class="text-center text-md-left">
                                <a class="btn btn-primary text-light" @click="submitForm('enquiry')">Send</a>
                            </div>
                            <div class="status"></div>
                        </div>
                        <!--Grid column-->

                        <!--Grid column-->
                        <div class="col-md-3 text-center">
                            <ul class="list-unstyled mb-0">
                                <li><i class="fas fa-map-marker-alt fa-2x"></i>
                                    <p>TARUMT, CA 94126, Kuala Lumpur</p>
                                </li>

                                <li><i class="fas fa-phone mt-4 fa-2x"></i>
                                    <p>+ 01 234 567 89</p>
                                </li>

                                <li><i class="fas fa-envelope mt-4 fa-2x"></i>
                                    <p>contact@tarumt.com</p>
                                </li>
                            </ul>
                        </div>
                        <!--Grid column-->
                    </div>
                </form>
            </div>

            <div id="tab2-content" style="margin-top: 30px;">
                <div class="card text-dark bg-light mb-3">
                    <div class="card-header">Header</div>
                    <div class="card-body">
                        <h5 class="card-title">Light card title</h5>
                        <p class="card-text">Some quick example text to build on the card title and make up the bulk of
                            the card's content.</p>
                    </div>
                </div>

            </div>

        </section>
        <!--Section: Contact v.2-->
    </main>

    <script type="text/javascript" src="js/responsee.js"></script>
    <script type="text/javascript" src="owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="js/template-scripts.js"></script>
    <script src="../plugins/axios/axios.min.js"></script>
    <script src="../plugins/element-ui/index.js"></script>
    <script src="../plugins/vue/vue.js"></script>
    <script src="../js/request.js"></script>
    <script src="./js/submitEnquiry.js"></script>
    <script src="../api/query.js"></script>

    <script>
        onload = async function () {
            console.log(localStorage.getItem('userInfo'));
            if (localStorage.getItem('userInfo') == null) {
                //navigate user to other page
                window.location.href("/dist/page/login.html?redirect=enquiry");
                //
            } else if (localStorage.getItem('userInfo') != null) {
                //get user info
                var userInfo = JSON.parse(localStorage.getItem('userInfo'));
                console.log(userInfo);
                let userEmail = userInfo['applicantEmail'];
                document.getElementById('email').value = userEmail;
                document.getElementById('name').value = userEmail.split('@')[0];

            } else {
                window.location.href("/dist/page/login.html?redirect=enquiry");
            }
            document.getElementById('tab2-content').style.display = 'none';
        }

        //onProgress();

        function onProgress() {
            let enquiryList = JSON.parse(localStorage.getItem('enquiry'));

            console.log(enquiryList);

            //let html = document.getElementById('tab2-content').innerHTML;
            let html = "";
            for (let i = 0; i < enquiryList.length; i++) {
                let enquiry = enquiryList[i];
                let email = enquiry['email'];
                let title = enquiry['title'];
                let ques = enquiry['question'];
                let date = enquiry['date'];
                let reply = enquiry['reply'];
                let status = enquiry['status'];

                let stats = 'border-danger';
                let statusText = 'Pending for reply...';

                if (reply != 'null') {
                    stats = 'border-success';
                    statusText = 'Replied !';
                }


                html += `
                <div onclick="replyEnquiry(${i})" class="card text-dark ${stats} bg-light mb-3">
                    <div class="card-header">${statusText}</div>
                    <div class="card-body">
                        <h5 class="card-title">${title}</h5>
                        <p class="card-text">${ques}</p>
                    </div>

                `;

                if (reply != 'null') {
                    html += `
                    <div class="card-footer text-muted">
                        ${reply}
                    </div>
                    `;
                }

                html += `</div>`;
            }

            document.getElementById('tab2-content').innerHTML = html;
        }

        function replyEnquiry(index) {
            console.log(index);
            let enquiryList = JSON.parse(localStorage.getItem('enquiry'));
            let enquiry = enquiryList[index];
            let reply = "Your reply is here";
            enquiry['reply'] = reply;
            enquiry['status'] = 'replied';
            enquiryList[0] = enquiry;
            localStorage.setItem('enquiry', JSON.stringify(enquiryList));
            window.location.reload();
            alert('Your reply has been submitted successfully!');
        }

        function onSubmit() {
            let usrname = document.getElementById('name').value; //localStorage.getItem('username');
            let email = document.getElementById('email').value;
            let title = document.getElementById('title').value;
            let ques = document.getElementById('message').value;
            let date = new Date();

            let enquiry = {
                name: usrname,
                email: email,
                title: title,
                question: ques,
                date: date,
                "reply": "null",
                "status": "pending"
            };

            if (localStorage.getItem('enquiry') == null) {
                localStorage.setItem('enquiry', JSON.stringify(enquiry));
                console.log(enquiry);
            } else {
                let enquiryList = JSON.parse(localStorage.getItem('enquiry'));
                enquiryList.push(enquiry);
                localStorage.setItem('enquiry', JSON.stringify(enquiryList));
                console.log(enquiryList);
            }

            alert('Your enquiry has been submitted successfully!');
            window.location.reload();
        }

        function showTab(tabIndex) {
            const tabContents = document.querySelectorAll('.nav-link');

            // Hide all tab contents
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Show the selected tab content
            const selectedTabContent = document.getElementById(`tab${tabIndex}`);
            selectedTabContent.classList.add('active');

            if (tabIndex == 1) {
                document.getElementById('tab1-content').style.display = 'block';
                document.getElementById('tab2-content').style.display = 'none';
            } else if (tabIndex == 2) {
                document.getElementById('tab2-content').style.display = 'block';
                document.getElementById('tab1-content').style.display = 'none';
            }

        }


    </script>

    <script>
        new Vue({
            el: '#submitEnquiry',
            data() {
                return {
                    enquiry: {
                        "title": "",
                        "question": "",
                        "reply": "",
                        "queryStatus": "",
                        "created": new Date().toISOString(),
                        "completed": new Date().toISOString(),
                        "applicantId": ""
                    },
                }
            },
            mounted() {
                // Data not available in localStorage, fetch it from the API
                console.log('MOUNT QUERY :');

                if (!localStorage.getItem('userInfo')) {
                    window.location.href = "/dist/page/login.html?redirect=enquiry";
                }
                this.init();
            },
            created() {
                // Call the init method when the component is created

                if (!localStorage.getItem('userInfo')) {
                    window.location.href = "/dist/page/login.html?redirect=enquiry";
                }
                this.init();
            },
            methods: {
                init() {
                    console.log('INIT QUERY :');
                    getAllQueries()
                        .then((response) => {
                            console.log('Response:', response);
                            // Rest of your code
                            let enquiryList = response.data;

                            console.log(enquiryList);

                            //let html = document.getElementById('tab2-content').innerHTML;
                            var userInfo = JSON.parse(localStorage.getItem('userInfo'));
                            let applicantId = userInfo['applicantId'];

                            let html = "";
                            for (let i = 0; i < enquiryList.length; i++) {
                                let enquiry = enquiryList[i];

                                let appId = enquiry['applicantId'];
                                if (appId == applicantId) {
                                    let title = enquiry['title'];
                                    let ques = enquiry['question'];
                                    let reply = enquiry['reply'];
                                    let status = enquiry['queryStatus'];
                                    let cdate = enquiry['completed'];
                                    let rdate = enquiry['created'];

                                    let stats = 'border-danger';
                                    let statusText = 'Pending for reply...';



                                    if (reply != 'null') {
                                        stats = 'border-success';
                                        statusText = 'Replied !';
                                    }


                                    html += `
    <div  class="card text-dark ${stats} bg-light mb-3">
        <div class="card-header">${statusText}</div>
        <div class="card-body">
            <h5 class="card-title">${title}</h5>
            <p class="card-text">${ques}</p>
        </div>

    `;

                                    if (reply != 'null') {
                                        html += `
        <div class="card-footer text-muted">
            ${reply}
        </div>
        `;
                                    }

                                    html += `</div>`;
                                }
                            }

                            document.getElementById('tab2-content').innerHTML = html;
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });
                },
                submitForm(enquiry) {
                    event.preventDefault();

                    console.log('ADD QUERY :', enquiry);

                    const params = { ...this.enquiry };
                    params.applicantEmail = localStorage.getItem('username');
                    params.applicantId = 1;
                    params.title = document.getElementById('title').value;
                    params.question = document.getElementById('message').value;
                    params.reply = 'null';
                    params.queryStatus = 'pending';
                    params.created = new Date().toISOString();
                    params.completed = new Date().toISOString();

                    console.log('PARAMS :', params);

                    addQuery(params).then((response) => {
                        console.log('Response:', response);
                        // Rest of your code
                    })
                        .catch((error) => {
                            console.error('Error:', error);
                            // Rest of your error handling code
                        });

                }

            },
        });
    </script>
    <script type="text/javascript" src="assets/js/header.js"></script>
    <script type="text/javascript" src="assets/js/footer.js"></script>
    <script src="assets/js/main.js"></script>
</body>

</html>